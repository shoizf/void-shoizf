#!/usr/bin/env bash
# installers/template — child installer template

set -euo pipefail

# --- Logging setup ---
LOG_DIR="$HOME/.local/log/void-shoizf"
mkdir -p "$LOG_DIR"
SCRIPT_NAME="$(basename "$0" .sh)"

# Check if we're being run by the master installer
if [ -n "$VOID_SHOIZF_MASTER_LOG" ]; then
  LOG_FILE="$VOID_SHOIZF_MASTER_LOG"
else
  # We are being run directly, create our own log
  TIMESTAMP="$(date '+%Y-%m-%d_%H-%M-%S')"
  LOG_FILE="$LOG_DIR/${SCRIPT_NAME}-${TIMESTAMP}.log"
fi

log() {
  local msg="[$(date '+%Y-%m-%d %H:%M:%S')] [$SCRIPT_NAME] $*"
  echo "$msg" | tee -a "$LOG_FILE"
}
# --- End Logging setup ---

log "▶ template starting"

# Detect VM if util exists
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [ -f "$SCRIPT_DIR/../utils/is_vm.sh" ]; then
  source "$SCRIPT_DIR/../utils/is_vm.sh" || true
else
  IS_VM=false
fi
log "INFO IS_VM=${IS_VM}"

# Example: skip heavy hardware steps when running in VM
if [[ "$IS_VM" == true ]]; then
  log "INFO Running in VM — skipping hardware-only steps"
else
  log "INFO Running on bare-metal — performing full steps"
fi

log "✅ template finished"
